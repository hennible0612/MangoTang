{% extends 'store/mypage.html' %}
{% load static %}
{% block mypage %}
    <head>
        <style>
            * {
                margin: 0;
                padding: 0;
            }

            .rate {
                float: left;
                height: 46px;
                padding: 0 10px;
            }

            .rate:not(:checked) > input {
                position: absolute;
                top: -9999px;
            }

            .rate:not(:checked) > label {
                float: right;
                width: 1em;
                overflow: hidden;
                white-space: nowrap;
                cursor: pointer;
                font-size: 30px;
                color: #ccc;
            }

            .rate:not(:checked) > label:before {
                content: '★ ';
            }

            .rate > input:checked ~ label {
                color: #ffc700;
            }

            .rate:not(:checked) > label:hover,
            .rate:not(:checked) > label:hover ~ label {
                color: #deb217;
            }

            .rate > input:checked + label:hover,
            .rate > input:checked + label:hover ~ label,
            .rate > input:checked ~ label:hover,
            .rate > input:checked ~ label:hover ~ label,
            .rate > label:hover ~ input:checked ~ label {
                color: #c59b08;
            }


        </style>
    </head>
    <form id="form">
        <h1>리뷰쓰기</h1>
        <hr>
        <h3>리뷰쓰기</h3>

        <div class="rate">
            <input type="radio" id="star5" name="rate" value="5"/>
            <label for="star5" title="text">5 stars</label>
            <input type="radio" id="star4" name="rate" value="4"/>
            <label for="star4" title="text">4 stars</label>
            <input type="radio" id="star3" name="rate" value="3"/>
            <label for="star3" title="text">3 stars</label>
            <input type="radio" id="star2" name="rate" value="2"/>
            <label for="star2" title="text">2 stars</label>
            <input type="radio" id="star1" name="rate" value="1"/>
            <label for="star1" title="text">1 star</label>
        </div>
        <br>
        <br>


        <h1>사유</h1>
        <textarea style="height: 300px;" class="form-control" name="reason" id="validationTextarea"
                  placeholder="사유를 입력해주세요"
                  required></textarea>
        <button style="margin-top: 20px" class="btn btn-primary btn-lg btn-block submit" type="submit">전송하기</button>
    </form>
    <script>
        var form = document.getElementById('form')
        form.addEventListener('submit', function (e) { //결제 버튼 클릭시
            e.preventDefault()
            submitFormData();
        });

        function submitFormData() {
            var data = {
                'reqstExrfn': null,
                'reason': null,
                'orderNumber':{{ itemData.orderHistory.order_number }},
                'sellerCode':{{ itemData.product.seller_code }}
            }

            data.reqstExrfn = form.radio.value
            data.reason = form.reason.value
            var url = "/submit/reqstExrfn";
            console.log(url)
            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({'data': data})

            }).then((response) => response.json())
                .then((data) => {

                    var msg = JSON.parse(data);
                    console.log(msg)
                    if (msg == "refundSuccessful") {//환불성공
                        alert("환불 성공")
                        window.location.replace('/mypage/orderhistory/')

                    } else if (msg == "refundRequestCompleted") { //환불신청완료료
                        alert("환불 신청 완료")
                        window.location.replace('/mypage/orderhistory/')

                    } else if (msg == "err") { //환불과정중에러
                        alert("환불 신청 과정 중 에러 오류가 계속 나면 고객센터로 연락 부탁드립니다.")

                    }

                })


        }
    </script>
{% endblock %}